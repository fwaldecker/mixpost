import{H as Q,D as O,q as L,h,o as n,w as e,a as t,A as G,e as k,c as p,j as v,t as i,a3 as K,k as r,F as D,r as P,I as X,v as q,W as Y,V as Z,J as ee,Q as te,y as z,u as se,aL as ae,i as le,M as oe,a5 as R,T as ie,U as T,l as B,a1 as M,b as o,g as ne,a8 as U,z as re,aw as ue,n as de,aM as ce}from"./app-C7yQ4yxP.js";import{u as me}from"./useSelectable-D4eEjBj_.js";import{_ as fe}from"./PageHeader-L61bBZJ1.js";import{_ as S,a as pe}from"./PostsFilter-DkQcdVAR.js";import{_ as C,T as ve}from"./Tab-QSPdE2y6.js";import{_ as _e}from"./Panel-DHnLtGhx.js";import{_ as F}from"./Checkbox-hSITjV1n.js";import{_ as m,a as W,T as he}from"./TableCell-Do7VWhok.js";import{_ as ge}from"./PureDangerButton-CTpho9ji.js";import{u as ke}from"./AlertText-DhpZmgf-.js";import{e as $e}from"./MediaUploads-BPiO_myE.js";import{u as we,_ as N,c as xe,b as be,a as ye}from"./VerticallyScrollableContent-uywc3QKz.js";import{_ as A}from"./Account-BdxLlc1J.js";import{_ as Ce}from"./SelectableBar-BMA_UiaG.js";import{_ as Ve}from"./Pagination-xEfeiBk8.js";import{_ as De}from"./NoResult-BiKMAkVj.js";import{T as Ie}from"./Trash-TUAkcl9a.js";import"./Flex-B0LjVlwe.js";import"./PureButtonLink-PaYLzY0E.js";import"./EllipsisVertical-Cfd6Agro.js";import"./Eye-16K59JCb.js";import"./ProviderIcon-H9joOgZv.js";import"./SearchInput-C73xFZvN.js";import"./nprogress-DktYLWPJ.js";import"./index.browser-OxPLOBIU.js";import"./ExclamationCircle-DNtr2LeT.js";import"./Textarea-Cj05CTrn.js";import"./SectionTitle-CrJ6iHdB.js";import"./Alert-nkqBEIg3.js";import"./Variable-BraupYaJ.js";import"./index-la4Rclr_.js";import"./EditorReadOnly-BtH5TmE6.js";import"./Refresh-LmV19YMu.js";import"./ArrowTopRightOnSquare-509xbi7A.js";import"./ColorPicker-DL_0ehOi.js";import"./ChevronLeft-Dhng4OHZ.js";const Pe={class:"w-44"},je={key:0,class:"text-sm mt-xs text-gray-500"},Be={key:1,class:"text-sm mt-xs text-gray-500"},Oe={class:"w-96 text-left break-words"},Re={key:0,class:"w-48 flex relative"},Te={key:0,class:"absolute top-0 -right-5 z-10"},Me={class:"flex flex-wrap gap-xs"},Ue={class:"flex gap-xs"},Se={class:"mr-xs"},Fe={class:"text-left"},Ne={class:"mr-xs flex items-center"},Ae={__name:"PostItem",props:{item:{type:Object,required:!0},filter:{type:Object,default:{accounts:[]}}},setup(a){const s=a,{getOriginalVersion:$,getAccountVersion:c}=ke(),{setupURLMetaForAllVersions:j}=we(),f=Q(()=>{if(!s.item.versions.length)return{excerpt:"",media:null,media_count:0};let w=s.item.accounts;s.filter.accounts.length&&(w=w.filter(u=>s.filter.accounts.includes(u.id)));const V=w.map(u=>{const g=c(s.item.versions,u.id);return g?g.content[0]:$(s.item.versions).content[0]}),x=V.length?V[0]:s.item.versions[0].content[0];return{excerpt:x.excerpt,media:x.media.length?x.media[0]:null,media_count:x.media.length}}),b=O(!1),y=()=>{b.value=!0,j(s.item.versions)},I=()=>{b.value=!1};return(w,V)=>{const x=L("tooltip");return n(),h(W,{hoverable:!0},{default:e(()=>[t(m,{class:"w-10"},{default:e(()=>[G(w.$slots,"checkbox")]),_:3}),t(m,{clickable:!0,onClick:y},{default:e(()=>[k("div",Pe,[t(N,{value:a.item.status},null,8,["value"]),a.item.status==="scheduled"||a.item.status==="needs_approval"?(n(),p("div",je,i(a.item.scheduled_at.human),1)):v("",!0),a.item.status==="published"?(n(),p("div",Be,i(a.item.published_at.human),1)):v("",!0)])]),_:1}),t(m,{clickable:!0,onClick:y,class:"pl-0!"},{default:e(()=>[k("div",Oe,i(f.value.excerpt),1)]),_:1}),t(m,{clickable:!0,onClick:y},{default:e(()=>[f.value.media?(n(),p("div",Re,[f.value.media?(n(),h($e,{key:0,media:f.value.media,"img-height":"sm",imgWidthFull:!1,showCaption:!1},{default:e(()=>[f.value.media_count>1?(n(),p("div",Te,[t(K,null,{default:e(()=>[r("+"+i(f.value.media_count-1),1)]),_:1})])):v("",!0)]),_:1},8,["media"])):v("",!0)])):v("",!0)]),_:1}),t(m,{clickable:!0,onClick:y},{default:e(()=>[k("div",Me,[(n(!0),p(D,null,P(a.item.tags,u=>(n(),h(xe,{key:u.id,item:u,removable:!1,editable:!1},null,8,["item"]))),128))])]),_:1}),t(m,null,{default:e(()=>[k("div",Ue,[(n(!0),p(D,null,P(a.item.accounts.slice(0,3),(u,g)=>(n(),p("div",{key:u.id,class:X({"-ml-6":g>0})},[q(t(A,{provider:u.provider,name:u.name,"img-url":u.image,active:!0},null,8,["provider","name","img-url"]),[[x,u.name]])],2))),128)),a.item.accounts.length>3?(n(),h(Y,{key:0,"width-classes":"w-64",placement:"bottom-end"},{trigger:e(()=>[t(ee,{class:"mt-4 font-semibold"},{default:e(()=>[r("+"+i(a.item.accounts.slice(3).length),1)]),_:1})]),content:e(()=>[t(be,null,{default:e(()=>[(n(!0),p(D,null,P(a.item.accounts.slice(3),u=>(n(),h(Z,{as:"div"},{default:e(()=>[k("span",Se,[t(A,{provider:u.provider,name:u.name,"img-url":u.image,active:!0},null,8,["provider","name","img-url"])]),k("span",Fe,i(u.name),1)]),_:2},1024))),256))]),_:1})]),_:1})):v("",!0)])]),_:1}),t(m,{align:"right"},{default:e(()=>[t(S,{itemId:a.item.id,trashed:a.item.trashed,class:"flex justify-end"},null,8,["itemId","trashed"])]),_:1}),t(te,{show:b.value,scrollableBody:!0,onClose:I},{body:e(()=>[t(N,{value:a.item.status,class:"mb-lg"},null,8,["value"]),b.value?(n(),h(ye,{key:0,accounts:a.item.accounts,versions:a.item.versions},null,8,["accounts","versions"])):v("",!0)]),footer:e(()=>[b.value?(n(),p(D,{key:0},[k("div",Ne,[t(S,{itemId:a.item.id,trashed:a.item.trashed},null,8,["itemId","trashed"])]),t(z,{onClick:I},{default:e(()=>[r(i(w.$t("general.close")),1)]),_:1})],64)):v("",!0)]),_:1},8,["show"])]),_:3})}}},Le={class:"row-py"},qe={class:"w-full row-px"},ze={class:"w-full row-px mt-lg"},We={key:0,class:"mt-lg"},Dt={__name:"Index",props:{filter:{type:Object,default:{}},posts:{type:Object},has_failed_posts:{type:Boolean,default:!1},has_needs_approval_posts:{type:Boolean,default:!1}},setup(a){const{t:s}=se(),$=a,c=O({keyword:$.filter.keyword,status:$.filter.status,tags:$.filter.tags,accounts:$.filter.accounts}),j=ae({urlMeta:{}});ce("postCtx",j);const{selectedRecords:f,putPageRecords:b,toggleSelectRecordsOnPage:y,deselectRecord:I,deselectAllRecords:w}=me(),V=le("workspaceCtx"),x=()=>$.posts.data.map(_=>_.id);oe(()=>{b(x()),R.on("postDelete",_=>{I(_)})}),ie(()=>{R.off("postDelete")}),T(()=>B.cloneDeep(c.value),B.throttle(()=>{M.get(route("mixpost.posts.index",{workspace:V.id}),B.pickBy(c.value),{preserveState:!0,only:["posts","filter"]})},300)),T(()=>$.posts.data,()=>{b(x())});const{notify:u}=de(),g=O(!1),E=()=>{M.delete(route("mixpost.posts.deleteMultiple",{workspace:V.id}),{data:{posts:f.value,status:c.value.status},onSuccess(){w(),u("success",$.filter.status==="trash"?s("post.posts_deleted"):s("post.posts_to_trash"))},onFinish(){g.value=!1}})};return(_,l)=>{const H=L("tooltip");return n(),p(D,null,[t(o(ne),{title:o(s)("post.posts")},null,8,["title"]),k("div",Le,[t(fe,{title:o(s)("post.posts")},{default:e(()=>[t(pe,{modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=d=>c.value=d),class:"md:ml-xs md:rtl:ml-0 md:rtl:mr-xs"},null,8,["modelValue"])]),_:1},8,["title"]),k("div",qe,[t(ve,null,{default:e(()=>[t(C,{onClick:l[1]||(l[1]=d=>c.value.status=null),active:!_.$page.props.filter.status},{default:e(()=>[r(i(o(s)("general.all")),1)]),_:1},8,["active"]),t(C,{onClick:l[2]||(l[2]=d=>c.value.status="draft"),active:_.$page.props.filter.status==="draft"},{default:e(()=>[r(i(o(s)("post.drafts")),1)]),_:1},8,["active"]),a.has_needs_approval_posts?(n(),h(C,{key:0,onClick:l[3]||(l[3]=d=>c.value.status="needs_approval"),active:_.$page.props.filter.status==="needs_approval"},{default:e(()=>[r(i(o(s)("post.needs_approval")),1)]),_:1},8,["active"])):v("",!0),t(C,{onClick:l[4]||(l[4]=d=>c.value.status="scheduled"),active:_.$page.props.filter.status==="scheduled"},{default:e(()=>[r(i(o(s)("post.scheduled")),1)]),_:1},8,["active"]),t(C,{onClick:l[5]||(l[5]=d=>c.value.status="published"),active:_.$page.props.filter.status==="published"},{default:e(()=>[r(i(o(s)("post.published")),1)]),_:1},8,["active"]),a.has_failed_posts?(n(),h(C,{key:1,onClick:l[6]||(l[6]=d=>c.value.status="failed"),active:_.$page.props.filter.status==="failed",class:"text-red-500"},{default:e(()=>[r(i(o(s)("post.failed")),1)]),_:1},8,["active"])):v("",!0),t(C,{onClick:l[7]||(l[7]=d=>c.value.status="trash"),active:_.$page.props.filter.status==="trash"},{default:e(()=>[r(i(o(s)("general.trash")),1)]),_:1},8,["active"])]),_:1})]),k("div",ze,[t(Ce,{count:o(f).length,onClose:o(w)},{default:e(()=>[q((n(),h(ge,{onClick:l[8]||(l[8]=d=>g.value=!0)},{default:e(()=>[t(Ie)]),_:1})),[[H,o(s)("general.delete")]])]),_:1},8,["count","onClose"]),t(_e,{"with-padding":!1},{default:e(()=>[t(he,null,{head:e(()=>[t(W,null,{default:e(()=>[t(m,{component:"th",scope:"col",class:"w-10"},{default:e(()=>[t(F,{checked:o(y),"onUpdate:checked":l[9]||(l[9]=d=>U(y)?y.value=d:null),disabled:!a.posts.meta.total},null,8,["checked","disabled"])]),_:1}),t(m,{component:"th",scope:"col",class:"w-44"},{default:e(()=>[r(i(o(s)("post.status")),1)]),_:1}),t(m,{component:"th",scope:"col",class:"pl-0! text-left"},{default:e(()=>[r(i(o(s)("post.content")),1)]),_:1}),t(m,{component:"th",scope:"col",class:"w-48"},{default:e(()=>[r(i(o(s)("post.media")),1)]),_:1}),t(m,{component:"th",scope:"col"},{default:e(()=>[r(i(o(s)("post.labels")),1)]),_:1}),t(m,{component:"th",scope:"col"},{default:e(()=>[r(i(o(s)("post.accounts")),1)]),_:1}),t(m,{component:"th",scope:"col"})]),_:1})]),body:e(()=>[(n(!0),p(D,null,P(a.posts.data,d=>(n(),h(Ae,{key:d.id,item:d,filter:a.posts.filter,onOnDelete:()=>{o(I)(d.id)}},{checkbox:e(()=>[t(F,{checked:o(f),"onUpdate:checked":l[10]||(l[10]=J=>U(f)?f.value=J:null),value:d.id},null,8,["checked","value"])]),_:2},1032,["item","filter","onOnDelete"]))),128))]),_:1}),a.posts.meta.total?v("",!0):(n(),h(De,{key:0,withPadding:!0},{default:e(()=>[r(i(o(s)("post.no_posts_found")),1)]),_:1}))]),_:1}),a.posts.meta.links.length>3?(n(),p("div",We,[t(Ve,{meta:a.posts.meta,links:a.posts.links},null,8,["meta","links"])])):v("",!0)])]),t(ue,{show:g.value,variant:"danger",onClose:l[12]||(l[12]=d=>g.value=!1)},{header:e(()=>[r(i(o(s)("post.delete_posts")),1)]),body:e(()=>[r(i(o(s)("post.confirmation_delete_post")),1)]),footer:e(()=>[t(z,{onClick:l[11]||(l[11]=d=>g.value=!1),class:"mr-xs rtl:mr-0 rtl:ml-xs"},{default:e(()=>[r(i(o(s)("general.cancel")),1)]),_:1}),t(re,{onClick:E},{default:e(()=>[r(i(o(s)("general.delete")),1)]),_:1})]),_:1},8,["show"])],64)}}};export{Dt as default};
