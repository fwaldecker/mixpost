import{N as O}from"./nprogress-DktYLWPJ.js";import{u as _e,D as T,H as z,U as oe,l as Y,n as we,aS as xe,M as q,T as ue,d1 as $e,c as h,o as s,F as E,r as se,e as w,A as G,k,t as i,I as L,h as S,j as d,aU as Ce,B as Se,i as H,a6 as ce,a7 as X,a as l,b as u,a8 as me,w as t,m as W,S as fe,q as ve,y as Q,v as pe,X as Te,a9 as he,Z as Ie,a2 as Me,Q as ae,x as Ve,a3 as De,V as R,a0 as Pe,Y as le,J as Ae,f as J,W as Ne,z as je,a5 as ne}from"./app-C7yQ4yxP.js";import{n as Fe}from"./index.browser-OxPLOBIU.js";import{E as Be}from"./ExclamationCircle-DNtr2LeT.js";import{V as Ee,P as re,_ as Ue,a as ze}from"./AlertText-DhpZmgf-.js";import{E as Oe}from"./EllipsisVertical-Cfd6Agro.js";import{T as de}from"./Trash-TUAkcl9a.js";import{_ as Le}from"./Textarea-Cj05CTrn.js";import{T as He,_ as Je}from"./Tab-QSPdE2y6.js";import{S as We}from"./SectionTitle-CrJ6iHdB.js";import{_ as ge}from"./SearchInput-C73xFZvN.js";import{_ as ye}from"./NoResult-BiKMAkVj.js";import{_ as be}from"./Alert-nkqBEIg3.js";import{_ as qe}from"./Flex-B0LjVlwe.js";const Z=(e="mixpost.media.fetchUploads",I={},v=-1,n=[])=>{const{t:$}=_e(),{notify:x}=we(),p=T("uploads"),N=z(()=>{const r=["uploads","stock"];return(!n.length||n.length&&n.includes("image/gif"))&&r.push("gifs"),r}),M=T(!1),V=T(!1),c=T(!1),g=T(1),m=T([]),f=T(null),C=T(""),y=T([]),P=r=>{const A=y.value.findIndex(F=>F.id===r.id);A<0&&!r.hasOwnProperty("error")&&(v===1?y.value=[r]:(y.value.length<v||v===-1)&&y.value.push(r)),A>=0&&y.value.splice(A,1)},D=()=>{y.value=[]},o=r=>y.value.findIndex(F=>F.id===r.id)!==-1,a=(r=!0)=>{if(!g.value)return;O.start();const A={page:g.value,keyword:C.value,mime_types:n};axios.get(route(e,I),{params:A}).then(function(F){const ie=F.data.links.next;ie&&(g.value=F.data.links.next.split("?page=")[1]),ie||(g.value=0),r||(m.value=F.data.data),r&&(m.value=[...m.value,...F.data.data])}).catch(()=>{x("error",$("media.error_retrieving_media"))}).finally(()=>{O.done(),M.value=!0})},B=(r,A)=>{V.value=!0,O.start(),axios.post(route("mixpost.media.download",I),{items:r,from:p.value}).then(F=>{A(F)}).catch(()=>{x("error",$("media.error_downloading_media"))}).finally(()=>{V.value=!1,O.done(),O.remove()})},j=r=>{m.value=m.value.filter(A=>!r.includes(A.id))},U=r=>{let A="";return r.forEach(F=>{F.source==="Unsplash"&&(A+=`
Photo by ${F.author} on Unsplash`)}),A},_=(r,A)=>{c.value=!0,O.start(),axios.delete(route("mixpost.media.delete",I),{data:{items:r}}).then(()=>{A()}).catch(()=>{x("error",$("media.error_deleting_media"))}).finally(()=>{c.value=!1,O.done(),O.remove()})},b=()=>{const r=new IntersectionObserver(A=>{A[0].isIntersecting&&a()});xe(()=>{r.observe(f.value)})};return oe(C,Y.debounce(()=>{g.value=1,a(!1)},300)),{activeTab:p,tabs:N,isLoaded:M,isDownloading:V,isDeleting:c,keyword:C,page:g,items:m,endlessPagination:f,selected:y,getMediaCrediting:U,downloadExternal:B,deletePermanently:_,removeItems:j,createObserver:b,toggleSelect:P,deselectAll:D,isSelected:o}},Ge=["data-column"],K={__name:"Masonry",props:{items:{type:Array,required:!0},columns:{type:Number,default:3}},setup(e){const I=e,v=T(null),n=T([]),$=T(!1);q(()=>{V(),window.addEventListener("resize",x)}),ue(()=>{window.removeEventListener("resize",x)});const x=Y.debounce(()=>{n.value.length!==p().length&&V()},300),p=()=>{let c=I.columns;$e().width<=768&&(c=2);const g=[];for(let m=0;m<c;m++)g.push({i:m,indexes:[]});return g},N=c=>{const g=c%n.value.length;n.value[g].indexes.push(c)},M=()=>{for(let c=0;c<I.items.length;c++)N(c)},V=()=>{$.value=!1,n.value.splice(0),n.value.push(...p()),$.value=!0,M()};return oe(()=>I.items,()=>{V()}),(c,g)=>(s(),h("div",{class:L(["flex -m-1",{"opacity-0":!$.value}])},[(s(!0),h(E,null,se(n.value,(m,f)=>(s(),h("div",{class:"flex flex-col grow basis-0 px-1",key:f},[(s(!0),h(E,null,se(m.indexes,C=>(s(),h("div",{class:"py-1",key:C,ref_for:!0,ref:`item_${C}`},[G(c.$slots,"default",{item:e.items[C],index:C},()=>[k(i(e.items[C]),1)])]))),128)),w("div",{class:"grow -mt-20 pt-20 min-h-[100px] -z-10",ref_for:!0,ref_key:"bottomRef",ref:v,"data-column":f},null,8,Ge)]))),128))],2))}},ee={__name:"MediaSelectable",props:{active:{type:Boolean,default:!1}},emits:["click"],setup(e){return(I,v)=>(s(),h("div",{onClick:v[0]||(v[0]=n=>I.$emit("click")),class:"w-full relative cursor-pointer box-border"},[G(I.$slots,"default"),w("div",{class:L(["absolute flex items-center justify-center top-0 right-0 mr-md mt-md w-7 h-7 rounded-full border border-white",{"bg-primary-500":e.active,"bg-black/20":!e.active}])},[e.active?(s(),S(Ce,{key:0,class:"text-white"})):d("",!0)],2)]))}},Re={},Xe={class:"absolute z-10 bottom-0 mb-xs left-0 ml-xs hidden group-hover:block shadow-mix"},Qe={class:"bg-white shadow-mix py-xs px-sm text-left rounded-md"};function Ye(e,I){return s(),h("div",Xe,[w("div",Qe,[G(e.$slots,"default")])])}const ke=Se(Re,[["render",Ye]]),Ze={key:0},Ke={key:0,class:"mt-lg"},et=["href"],tt=["href"],st={__name:"MediaStock",props:{columns:{type:Number,default:3},maxSelectedItems:{type:Number,default:-1}},setup(e,{expose:I}){const v=H("workspaceCtx"),n=e,{user:$}=ce(),x=z(()=>Y.snakeCase(X().props.app.name)),p=z(()=>X().props.is_configured_service.unsplash),{isLoaded:N,keyword:M,items:V,endlessPagination:c,selected:g,toggleSelect:m,deselectAll:f,isSelected:C,createObserver:y}=Z("mixpost.media.fetchStock",{workspace:v.id},n.maxSelectedItems);return q(()=>{p.value&&y()}),I({selected:g,deselectAll:f}),(P,D)=>(s(),h(E,null,[p.value?(s(),h("div",Ze,[l(ge,{modelValue:u(M),"onUpdate:modelValue":D[0]||(D[0]=o=>me(M)?M.value=o:null),placeholder:P.$t("service.unsplash.search")},null,8,["modelValue","placeholder"]),u(V).length?(s(),h("div",Ke,[l(K,{items:u(V),columns:e.columns},{default:t(({item:o})=>[o?(s(),S(ee,{key:0,active:u(C)(o),onClick:a=>u(m)(o)},{default:t(()=>[l(te,{media:o},{default:t(()=>[l(ke,null,{default:t(()=>[w("div",null,[k(i(P.$t("media.image_source"))+": ",1),w("a",{href:`https://unsplash.com/?utm_source=${x.value}&utm_medium=referral`,target:"_blank",class:"link"},"Unsplash",8,et)]),w("div",null,[k(i(P.$t("media.author"))+": ",1),w("a",{href:`${o.credit_url}?utm_source=${x.value}&utm_medium=referral`,target:"_blank",class:"link"},i(o.name),9,tt)])]),_:2},1024)]),_:2},1032,["media"])]),_:2},1032,["active","onClick"])):d("",!0)]),_:1},8,["items","columns"])])):d("",!0),u(N)&&!u(V).length?(s(),S(ye,{key:1,class:"mt-lg"},{default:t(()=>[k(i(P.$t("media.no_images_found")),1)]),_:1})):d("",!0),w("div",{ref_key:"endlessPagination",ref:c,class:"-z-10 w-full"},null,512)])):d("",!0),p.value?d("",!0):(s(),h(E,{key:1},[l(be,{variant:"warning",closeable:!1},{default:t(()=>[k(i(P.$t("service.not_configured_service",{service:"Unsplash"})),1)]),_:1}),u($).is_admin?(s(),S(u(fe),{key:0,href:P.route("mixpost.services.index"),class:"block mt-md"},{default:t(()=>[l(W,null,{default:t(()=>[k(i(P.$t("media.click_configure")),1)]),_:1})]),_:1},8,["href"])):d("",!0)],64))],64))}},at={key:0},lt={key:0,class:"mt-lg"},ot={__name:"MediaGifs",props:{columns:{type:Number,default:3},maxSelectedItems:{type:Number,default:-1}},setup(e,{expose:I}){const v=H("workspaceCtx"),n=e,{user:$}=ce(),x=z(()=>X().props.is_configured_service.tenor),{isLoaded:p,keyword:N,items:M,endlessPagination:V,selected:c,toggleSelect:g,deselectAll:m,isSelected:f,createObserver:C}=Z("mixpost.media.fetchGifs",{workspace:v.id},n.maxSelectedItems);return q(()=>{x.value&&C()}),I({selected:c,deselectAll:m}),(y,P)=>(s(),h(E,null,[x.value?(s(),h("div",at,[l(ge,{modelValue:u(N),"onUpdate:modelValue":P[0]||(P[0]=D=>me(N)?N.value=D:null),placeholder:y.$t("service.tenor.search_gifs")},null,8,["modelValue","placeholder"]),u(M).length?(s(),h("div",lt,[l(K,{items:u(M),columns:e.columns},{default:t(({item:D})=>[D?(s(),S(ee,{key:0,active:u(f)(D),onClick:o=>u(g)(D)},{default:t(()=>[(s(),S(te,{media:D,key:D.id,class:"group"},{default:t(()=>[l(ke,null,{default:t(()=>[k(i(y.$t("service.tenor.gif")),1)]),_:1})]),_:2},1032,["media"]))]),_:2},1032,["active","onClick"])):d("",!0)]),_:1},8,["items","columns"])])):d("",!0),u(p)&&!u(M).length?(s(),S(ye,{key:1,class:"mt-lg"},{default:t(()=>[k(i(y.$t("media.no_gifs_found")),1)]),_:1})):d("",!0),w("div",{ref_key:"endlessPagination",ref:V,class:"-z-10 w-full"},null,512)])):d("",!0),x.value?d("",!0):(s(),h(E,{key:1},[l(be,{variant:"warning",closeable:!1},{default:t(()=>[k(i(y.$t("service.not_configured_service",{service:"Tenor"})),1)]),_:1}),u($).is_admin?(s(),S(u(fe),{key:0,href:y.route("mixpost.services.index"),class:"block mt-md"},{default:t(()=>[l(W,null,{default:t(()=>[k(i(y.$t("media.click_configure")),1)]),_:1})]),_:1},8,["href"])):d("",!0)],64))],64))}},it={class:"mt-lg"},nt={__name:"AddMedia",props:{maxSelection:{type:Number,default:1},combinesMimeTypes:{type:String,default:""},showImmediate:{type:Boolean,default:!1},disableTrigger:{type:Boolean,default:!1},maxSelectedItems:{type:Number,default:-1},mimeTypes:{type:Array,default:[]}},emits:["insert","close"],setup(e,{emit:I}){const v=H("workspaceCtx"),n=e,$=I,x=T(!1),{activeTab:p,tabs:N,isDownloading:M,downloadExternal:V,getMediaCrediting:c}=Z("mixpost.media.fetchStock",{workspace:v.id},n.maxSelectedItems,n.mimeTypes),g={uploads:St,stock:st,gifs:ot},m=T(),f=z(()=>g[p.value]),C=()=>{const a={maxSelectedItems:n.maxSelectedItems};return f.value===g.uploads&&(a.mimeTypes=n.mimeTypes),a},y=z(()=>m.value?m.value.selected:[]),P=()=>{m.value.deselectAll()},D=()=>{P(),x.value=!1,p.value="uploads",n.showImmediate&&$("close")},o=()=>{const a=p.value!=="uploads";a&&V(y.value.map(B=>{const{id:j,url:U,source:_,author:b,download_data:r}=B;return{id:j,url:U,source:_,author:b,download_data:r}}),B=>{$("insert",{items:B.data,crediting:c(B.data)}),D()}),a||($("insert",{items:y.value,crediting:c(y.value)}),D())};return(a,B)=>{const j=ve("tooltip");return s(),h(E,null,[n.disableTrigger?d("",!0):(s(),h("div",{key:0,onClick:B[0]||(B[0]=U=>x.value=!x.value)},[G(a.$slots,"default")])),l(ae,{show:x.value||n.showImmediate,"max-width":"2xl",closeable:!0,"scrollable-body":!0,onClose:D},{header:t(()=>[k(i(a.$t("media.add_media")),1)]),body:t(()=>[u(M)?(s(),S(he,{key:0,opacity:75},{default:t(()=>[k(i(a.$t("media.downloading")),1)]),_:1})):d("",!0),l(He,null,{default:t(()=>[(s(!0),h(E,null,se(u(N),U=>(s(),S(Je,{onClick:_=>p.value=U,active:u(p)===U},{default:t(()=>[k(i(a.$t(`media.${U}`)),1)]),_:2},1032,["onClick","active"]))),256))]),_:1}),w("div",it,[(s(),S(Ie(f.value),Me({ref_key:"sourceProperties",ref:m},C()),null,16))])]),footer:t(()=>[l(Q,{onClick:D,class:"mr-xs rtl:mr-0 rtl:ml-xs"},{default:t(()=>[k(i(a.$t("general.cancel")),1)]),_:1}),n.maxSelectedItems===1?(s(),S(W,{key:0,onClick:o},{default:t(()=>[k(i(a.$t("general.insert")),1)]),_:1})):y.value.length?(s(),h(E,{key:1},[pe((s(),S(Q,{onClick:P,class:"mr-xs rtl:mr-0 rtl:ml-xs"},{icon:t(()=>[l(Te)]),_:1})),[[j,a.$t("general.dismiss"),void 0,{top:!0}]]),l(W,{onClick:o},{default:t(()=>[k(i(a.$t("general.insert"))+" "+i(y.value.length)+" "+i(a.$t("general.items")),1)]),_:1})],64)):d("",!0)]),_:1},8,["show"])],64)}}},rt={key:0,class:"absolute top-0 left-0 mt-1 ml-1"},dt={key:1,class:"text-center"},ut={class:"mt-xs"},ct={class:"mt-xs text-red-500"},mt=["src","title"],ft={key:0,class:"absolute top-0 left-0 mt-1 ml-1"},vt={key:5,class:"absolute top-0 -mt-xs right-0 -mr-xs"},pt={class:"bg-white border-2 border-gray-400 rounded-full"},ht={key:0,class:"mt-xs text-sm break-all"},gt=["src","alt"],yt={class:"mt-lg"},te={__name:"MediaFile",props:{media:{type:Object,required:!0},imgHeight:{type:String,default:"full"},placeholderHeight:{type:String,default:"default"},imgWidthFull:{type:Boolean,default:!0},showCaption:{type:Boolean,default:!0},editMode:{type:Boolean,default:!0},showDropdownMenu:{type:Boolean,default:!1},enableVideoThumb:{type:Boolean,default:!1},providersWithVideoThumbEnabled:{type:Array,default:()=>[]}},emits:["update","remove","open","addCustomVideoThumb","removeCustomVideoThumb"],setup(e,{emit:I}){const v=e,n=H("workspaceCtx"),$=H("routePrefix"),x=I,p=z(()=>({full:"h-full",sm:"h-20"})[v.imgHeight]),N=z(()=>!v.editMode&&!v.media.is_video?!1:!v.editMode&&v.media.is_video?v.media.video_custom_thumb_url!==null:v.showDropdownMenu),M=z(()=>v.enableVideoThumb&&v.media.is_video),V=z(()=>!v.media.is_video),c=T(!1),g=T(!1),m=T(!1),f=Ve({alt_text:""}),C=o=>{c.value=!0,f.id=o.id,f.alt_text=o.alt_text},y=()=>{c.value=null,f.reset()},P=()=>{f.put(route(`${$}.media.update`,{id:f.id,workspace:n.id}),{onSuccess:()=>{const o=Y.clone(v.media);o.alt_text=f.alt_text,x("update",o),y()}})},D=()=>{v.editMode&&(x("removeCustomVideoThumb"),m.value=!1)};return(o,a)=>{const B=ve("tooltip");return s(),h(E,null,[w("figure",{class:L([{"border border-gray-200 rounded-md p-xs bg-stone-500":e.showCaption},"group relative"])},[G(o.$slots,"default"),w("div",{class:L(["relative flex rounded",{"border border-red-500 p-md":e.media.hasOwnProperty("error")}])},[e.media.is_video&&e.media.thumb_url?(s(),h("span",rt,[l(Ee,{class:"!w-4 !h-4 text-white"}),e.enableVideoThumb&&e.media.video_custom_thumb_url?(s(),S(re,{key:0,class:"!w-4 !h-4 text-white mt-1.5"})):d("",!0)])):d("",!0),e.media.hasOwnProperty("error")?(s(),h("div",dt,[l(Be,{class:"w-8 h-8 mx-auto text-red-500"}),w("div",ut,i(e.media.name),1),w("div",ct,i(e.media.error?e.media.error:o.$t("media.error_uploading_media")),1)])):d("",!0),N.value&&e.media.alt_text?pe((s(),S(De,{key:2,variant:"dark",class:"absolute bottom-[3px] left-[3px] text-xs font-medium"},{default:t(()=>a[11]||(a[11]=[w("span",{class:"uppercase"},"alt",-1)])),_:1})),[[B,{content:e.media.alt_text,triggers:["click"],autoHide:!0}]]):d("",!0),e.media.thumb_url?(s(),h("img",{key:3,src:e.media.thumb_url,title:e.media.name,alt:"Image",loading:"lazy",class:L(["rounded-md",[p.value,{"w-full":e.imgWidthFull}]]),onClick:a[0]||(a[0]=j=>o.$emit("open"))},null,10,mt)):d("",!0),e.media.is_video&&!e.media.thumb_url?(s(),S(Ue,{key:4,type:"video",widthClass:e.imgWidthFull?"w-full":"w-28",heightClass:{default:"h-28",sm:"h-20"}[e.placeholderHeight]},{default:t(()=>[e.enableVideoThumb&&e.media.video_custom_thumb_url?(s(),h("span",ft,[l(re,{class:"!w-4 !h-4 text-black"})])):d("",!0)]),_:1},8,["widthClass","heightClass"])):d("",!0),N.value?(s(),h("div",vt,[l(Ne,{widthClasses:"w-auto",placement:"top-start"},{trigger:t(()=>[l(Ae,{class:"w-6 h-6 bg-white rounded-full flex items-center justify-center",onClick:a[1]||(a[1]=J(()=>{},["prevent"]))},{icon:t(()=>[w("div",pt,[l(Oe,{class:"!w-5 !h-5"})])]),_:1})]),content:t(()=>[V.value&&e.editMode?(s(),S(R,{key:0,as:"button",onClick:a[2]||(a[2]=j=>C(e.media))},{icon:t(()=>[l(Pe)]),default:t(()=>[k(" "+i(o.$t("media.edit_alt_text")),1)]),_:1})):d("",!0),M.value&&e.editMode?(s(),S(R,{key:1,as:"button",onClick:a[3]||(a[3]=j=>g.value=!0)},{icon:t(()=>[l(le)]),default:t(()=>[k(" "+i(e.media.video_custom_thumb_url?o.$t("media.change_video_thumb"):o.$t("media.add_video_thumb")),1)]),_:1})):d("",!0),M.value&&e.media.video_custom_thumb_url?(s(),S(R,{key:2,as:"button",onClick:a[4]||(a[4]=j=>m.value=!0)},{icon:t(()=>[l(le)]),default:t(()=>[k(" "+i(o.$t("media.view_video_thumb")),1)]),_:1})):d("",!0),e.editMode?(s(),S(R,{key:3,as:"button",onClick:a[5]||(a[5]=j=>x("remove"))},{icon:t(()=>[l(de,{class:"text-red-500"})]),default:t(()=>[k(" "+i(o.$t("general.remove")),1)]),_:1})):d("",!0)]),_:1})])):d("",!0)],2),e.showCaption?(s(),h("figcaption",ht,i(e.media.name),1)):d("",!0)],2),l(ae,{show:m.value,onClose:a[7]||(a[7]=j=>m.value=!1)},{header:t(()=>[k(i(o.$t("media.view_video_thumb")),1)]),body:t(()=>[l(ze,{variant:"warning",class:"mb-xs"},{default:t(()=>[k(i(o.$t("media.video_thumb_providers",{providers:e.providersWithVideoThumbEnabled.join(", ")})),1)]),_:1}),w("figure",null,[w("img",{src:e.media.video_custom_thumb_url,alt:o.$t("media.video_thumb")},null,8,gt)])]),footer:t(()=>[l(qe,null,{default:t(()=>[e.editMode?(s(),S(je,{key:0,onClick:D,size:"md"},{icon:t(()=>[l(de)]),default:t(()=>[k(" "+i(o.$t("general.remove")),1)]),_:1})):d("",!0),l(Q,{onClick:a[6]||(a[6]=j=>m.value=!1),class:"mr-xs"},{default:t(()=>[k(i(o.$t("general.close")),1)]),_:1})]),_:1})]),_:1},8,["show"]),l(ae,{show:c.value,"max-width":"md",closeable:!0,"scrollable-body":!0,onClose:y},{header:t(()=>[k(i(o.$t("media.edit_alt_text")),1)]),body:t(()=>[w("div",null,i(o.$t("media.add_alt_text_for",{platforms:"Facebook, Instagram, Threads, X, Mastodon, Pinterest, Bluesky and LinkedIn"})),1),w("div",yt,[l(Le,{modelValue:u(f).alt_text,"onUpdate:modelValue":a[8]||(a[8]=j=>u(f).alt_text=j),placeholder:o.$t("media.write_alt_text")},null,8,["modelValue","placeholder"])])]),footer:t(()=>[l(Q,{onClick:y,class:"mr-xs"},{default:t(()=>[k(i(o.$t("general.cancel")),1)]),_:1}),l(W,{onClick:P,isLoading:u(f).processing,disabled:u(f).processing},{default:t(()=>[k(i(o.$t("general.save")),1)]),_:1},8,["isLoading","disabled"])]),_:1},8,["show"]),M.value?(s(),S(nt,{key:0,disableTrigger:!0,maxSelectedItems:1,mimeTypes:["image/jpg","image/jpeg","image/png"],showImmediate:g.value,onInsert:a[9]||(a[9]=j=>o.$emit("addCustomVideoThumb",j.items[0])),onClose:a[10]||(a[10]=j=>g.value=!1)},null,8,["showImmediate"])):d("",!0)],64)}}},bt={class:"relative flex flex-col justify-center"},kt={class:"text-center mb-1"},_t={for:"browse",class:"cursor-pointer text-primary-500 hover:text-primary-700 active:text-primary-700 focus:outline-hidden focus:text-primary-700 transition-colors ease-in-out duration-200"},wt={class:"text-sm text-gray-400 text-center"},xt=["accept"],$t={key:0,class:"mt-lg"},Ct={__name:"UploadMedia",props:{maxSelection:{type:Number,default:1},combinesMimeTypes:{type:String,default:""},selected:{type:Array,default:[]},toggleSelect:{type:Function},isSelected:{type:Function},columns:{type:Number,default:3},mimeTypes:{type:Array,default:[]}},emits:["mediaSelect"],setup(e,{emit:I}){const v=H("workspaceCtx"),n=e,$=n.mimeTypes.length?n.mimeTypes:X().props.mixpost.mime_types,x=T(null),p=T(!1),N=_=>{if(c.value)return;p.value=!1;const b=V(_.dataTransfer.files);b.length&&B(b)},M=_=>{const b=V(_.target.files);b.length&&(x.value.value=null,B(b))},V=_=>Array.from(_).filter(b=>$.includes(b.type)),c=T(!1),g=T([]),m=T([]),f=T({});oe(f,()=>{C(),c.value=Object.keys(f.value).length>0});const C=()=>{f.value.handler&&f.value.handler()},y=_=>{g.value.push(_),Object.keys(f.value).length===0&&P()},P=_=>{Object.keys(f.value).length>0&&(a(f.value,_),n.toggleSelect&&n.toggleSelect(_)),g.value.length>0?(D(g.value[0]),o()):D({})},D=_=>{f.value=_},o=()=>{g.value.shift()},a=(_,b)=>{m.value.push(Object.assign(_,{media:b}))},B=_=>{_.forEach(b=>{y({id:Fe(),handler:async()=>{await j(b).then(r=>{P(r)}).catch(r=>{P({name:b.name,error:r.response.data.message})})}})})},j=_=>{const b=new FormData;return b.append("file",_),new Promise((r,A)=>{axios.post(route("mixpost.media.upload",{workspace:v.id}),b).then(function(F){r(F.data)}).catch(function(F){A(F)})})},U=z(()=>m.value.filter(()=>!0).reverse());return q(()=>{ne.on("mediaDelete",_=>{m.value=m.value.filter(b=>!_.includes(b.media.id))})}),ue(()=>{ne.off("mediaDelete")}),(_,b)=>(s(),h(E,null,[w("div",{onDragenter:b[2]||(b[2]=J(r=>p.value=!c.value,["prevent"])),onDrop:J(N,["prevent"]),onDragover:b[3]||(b[3]=J(()=>{},["prevent"])),class:L([{"border-gray-700 bg-white":!p.value,"border-cyan-500 bg-cyan-50":p.value},"relative w-full flex items-center justify-center rounded-lg p-10 border-2 border-dashed transition-colors ease-in-out duration-200"])},[w("div",bt,[p.value?(s(),h("div",{key:0,onDragleave:b[0]||(b[0]=J(r=>p.value=!1,["prevent"])),onDragover:b[1]||(b[1]=J(()=>{},["prevent"])),class:"w-full h-full absolute"},null,32)):d("",!0),l(le,{class:L([{"text-stone-700":!p.value,"text-cyan-500":p.value},"w-16! h-16! mx-auto mb-xs transition-colors ease-in-out duration-200"])},null,8,["class"]),w("div",kt,[k(i(_.$t("media.drag_drop_files"))+" ",1),w("label",_t,i(_.$t("general.browse")),1)]),w("div",wt,i(u($).join(", ")),1)]),c.value?(s(),S(he,{key:0,size:"xl",class:"rounded-lg"})):d("",!0)],34),w("input",{ref_key:"input",ref:x,id:"browse",type:"file",accept:u($).join(","),multiple:"multiple",class:"hidden",onChange:M},null,40,xt),U.value.length?(s(),h("div",$t,[l(K,{items:U.value,columns:e.columns},{default:t(({item:r})=>[l(ee,{active:e.isSelected(r.media),onClick:A=>e.toggleSelect(r.media)},{default:t(()=>[l(te,{media:r.media},null,8,["media"])]),_:2},1032,["active","onClick"])]),_:1},8,["items","columns"])])):d("",!0)],64))}},St={__name:"MediaUploads",props:{columns:{type:Number,default:3},maxSelectedItems:{type:Number,default:-1},mimeTypes:{type:Array,default:[]}},setup(e,{expose:I}){const v=H("workspaceCtx"),n=e,{items:$,endlessPagination:x,selected:p,toggleSelect:N,deselectAll:M,removeItems:V,isSelected:c,createObserver:g}=Z("mixpost.media.fetchUploads",{workspace:v.id},n.maxSelectedItems,n.mimeTypes);return q(()=>{g()}),I({selected:p,deselectAll:M,removeItems:V}),(m,f)=>(s(),h(E,null,[l(Ct,{"max-selection":4,"combines-mime-types":"",selected:u(p),toggleSelect:u(N),isSelected:u(c),columns:e.columns,mimeTypes:n.mimeTypes},null,8,["selected","toggleSelect","isSelected","columns","mimeTypes"]),w("div",{class:L({"mt-lg":u($).length})},[u($).length?(s(),h(E,{key:0},[l(We,{class:"mb-4"},{default:t(()=>[k(i(m.$t("media.library")),1)]),_:1}),l(K,{items:u($),columns:e.columns},{default:t(({item:C})=>[C?(s(),S(ee,{key:0,active:u(c)(C),onClick:y=>u(N)(C)},{default:t(()=>[l(te,{media:C},null,8,["media"])]),_:2},1032,["active","onClick"])):d("",!0)]),_:1},8,["items","columns"])],64)):d("",!0),w("div",{ref_key:"endlessPagination",ref:x,class:"-z-10 w-full"},null,512)],2)],64))}};export{ot as _,st as a,St as b,K as c,nt as d,te as e,Z as u};
